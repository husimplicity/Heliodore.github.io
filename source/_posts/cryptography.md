---
title: 密码学
date: 2020-04-08 23:03:48
tags:
  - 琉璃猫
categories:
  - [猫爪记, Mathematics]
mathjax: true
---

# 古典密码学

## 几种古典密码

移位密码（K=3即为凯撒密码）
$$
e_k(x)=(x+K)\:mod\:26\\
d_k(y)=(x-K)\:mod\:26
$$
代换密码
$$
e_\pi(x)=\pi(x)\\
d_\pi(x)=\pi^{-1}(x)
$$
仿射密码
$$
e(x)=(ax+b)\:mod\:26\\
d(y)=a^{-1}(y-b)\:mod\:26\\
gcd(a,26)=1\:(保证a^{-1}唯一)
$$
维吉尼亚密码
$$
e(x_1,x_2,...,x_m)=(x_1+k_1,x_2+k_2,...,x_m+k_m)\\
d(y_1,y_2,...,y_m)=(y_1-k_1,y_2-k_2,...,y_m-k_m)
$$
希尔密码
$$
e(x)=xK\\
d(x)=yK^{-1}\\
K为Z_{26}上的m\times m可逆矩阵
$$
置换密码
$$
e_\pi(x_1,x_2,...,x_m)=(x_{\pi(1)},x_{\pi(2)},...,x_{\pi(m)})\\
d_\pi(y_1,y_2,...,y_m)=(y_{\pi^{-1}(1)},y_{\pi^{-1}(2)},...,y_{\pi^{-1}(m)})
$$
流密码

自动秘钥密码
$$
e_z(x)=(x+z)\:mod\:26\\
d_z(y)=(y-z)\:mod\:26\\
z_i=x_{i-1}，x_1=K
$$

## 密码分析

常见攻击类型：

+ 唯密文攻击
+ 已知明文攻击
+ 选择明文攻击：有加密机访问权限
+ 选择密文攻击：有解密机访问权限

统计分析：

根据字母出现的频率（或者结合二元组出现频率）

维吉尼亚密码的分析：

Kasiski测试法，搜索长度至少为3的相同密文段，记录这些密文段到起始点之间的距离，猜测m为这些距离的最大公因子的因子

重合指数法，随机两个字母相等的概率（称为重合指数）为0.038，如果相隔为m，这个概率提高到0.065

希尔密码的分析：

需要至少m个不同的明-密文对

# Shannon理论

1949年Claude Shannon发表的"Communication Theory of Secrecy Systems"

+ 计算安全性：度量破解所做的计算
+ 可证明安全性：归入数学难题
+ 无条件安全性

**完善保密性**定义为对任意明文x，密文y，有$P(x|y)=P(x)$

定义：密文空间C、明文空间P、密钥空间K

定理：如果密码体制满足|K|=|C|=|P|。那么这个密码体制是完善保密的，当且仅当每个密钥被使用的概率为1/|K|，且对$x\in P$，$y\in C$，存在唯一的密钥K，$e_K(x)=y$。

一个著名的完善保密的密码体制是”一次一密“，$P=C=K=(Z_2)^n$，加密和解密都是取异或。但是这个体制要求用n比特的密钥加密n比特的明文，且对已知明文攻击是脆弱的。

由于以概率$2^{-n}$发生的事件可以编码为长度为n的比特串，因此定义随机变量X的熵为
$$
H(X)=-\sum P(x)log(x)
$$
**Huffman算法**找到了使得加权平均编码长度最小的**单射**编码l，他是无前缀的，并且
$$
H(X)\leq l(f)<H(X)+1
$$
熵的性质

+ $H(X)\leq log(n)$
+ $H(X,Y)\leq H(X)+H(Y)$，(X、Y独立时取等号)
+ $H(X,Y)=H(Y)+H(X|Y)$
+ $H(X|Y)\leq H(X)$

定义条件熵H(K|C)为密钥含糊度。那么
$$
H(K|C)=H(K)+H(P)-H(C)
$$
($H(K|C)=H(K,C)-H(C)=H(K,P,C)-H(C)=H(K,P)-H(C)=H(K)+H(P)-H(C)$)

自然语言L的熵定义为
$$
H_L=\lim_{n\to\infty}\frac{H(P^n)}{n}
$$
语言L的冗余度定义为
$$
R_L=1-\frac{H_L}{log_2|P|}
$$
英语中$H(P)=4.19$，$H(P^2)/2=3.90$，$1.0\leq H_L\leq 1.5$

定理：|C|=|P|且密钥是等概率选取的，那么给定长为n的密文串，伪密钥的期望数满足
$$
\bar{s_n}\geq \frac{|K|}{|P|^{nR_L}}-1
$$
($\bar{s_n}=\sum P(y)|K(y)|-1$，而$H(K|C)=H(K)+H(P^n)-H(C^n)\geq H(K)-nR_Llog_2|P|$)

定义**唯一解距离**为使得伪密钥期望等于0的n，记为$n_0$。这是给定足够时间下，分析者能唯一计算出密钥所需密文的平均量。
$$
n\approx \frac{log_2|K|}{R_Llog_2|P|}
$$
**乘积密码体制**密钥$K=(K_1,K_2)$，定义加密解密如下
$$
e_{(K_1,K_2)}(x)=e_{K_2}(e_{K_1}(x))\\
d_{(K_1,K_2)}(y)=d_{K_1}(d_{K_2}(y))
$$
如果密码体制不是幂等的，那么多次迭代有可能提高安全性。

# 分组密码和高级加密标准

大多数分组密码都是乘积密码：用K来生成$N_r$个**轮密钥**（也叫子密钥），轮密钥的列表就是**密钥编排方案**。通过这些轮密钥依次进行加密。

## 代换-置换网络（SPN）

$$
\pi_s:\{0,1\}^l\to\{0,1\}^l\\
\pi_p:\{1,...,lm\}\to\{1,...,lm\}
$$

均为置换，设$P=C=\{0,1\}^{lm}$，$K\subset(\{0,1\}^{lm})^{N_r+1}$是由K生成的密钥编排方案的集合。

每轮加密先用异或操作混入该轮密钥，再用$\pi_s$进行m次代换，再用$\pi_p$进行一次置换。（最后一轮只做异或操作）

## 线性密码分析

取值01的随机变量$P(X_i=1)=p_i$，定义**偏差**$e_i=p_i-1$

堆积引理：独立随机变量$X_i$，那么随机变量$X_1\oplus X_2\oplus ... \oplus X_n$的偏差满足
$$
e=2^{k-1}\prod_{j=1}^ke_k
$$
对于一个置换$\pi_s:\{0,1\}^4\to\{0,1\}^4$，把每个相关的随机变量表示成如下形式
$$
(\oplus_{i=1}^4a_iX_i)\oplus(\oplus_{i=1}^4b_iY_i)
$$
设$N_L(a,b)$表示满足如下条件的8元组对(a,b),(x,y)的个数
$$
(y_1,y_2,y_3,y_4)=\pi_S(x_1,x_2,x_3,x_4)\\
(\oplus_{i=1}^4a_iX_i)\oplus(\oplus_{i=1}^4b_iY_i)=0
$$
该随机变量的偏差$e(a,b)=(N_L(a,b)-8)/16$

一个基于偏差为$e$的线性逼近的线性攻击想要成功所需要的的明-密文对数$T\approx ce^{-2}$

## 差分分析

定义$\Delta(x')=\{(x,x^\*|x\oplus x^\*=x'\}$，则显然这个集合大小为$2^m$

定义
$$
N_D(x',y')=|\{(x,x^*)\in \Delta(x'):\pi_s(x)\oplus\pi_s(x^*)=y'\}|
$$
由此定义对应于差分$(a',b')$的扩散率
$$
R_p(a',b')=\frac{N_D(a',b')}{2^m}(=P(b'|a'))
$$
一个基于扩散率为e的差分攻击，需要4重组$(x,x^\*,y,y^\*)$的数量$T\approx ce^{-1}$

## 数据加密标准

DES是一种特殊的迭代密码，叫做**Feistel型密码**，每个状态$u^i$被分成长度相同的两部分$L^i$和$R^i$，轮函数g有如下形式
$$
g(L^{i-1},R^{i-1},K^i)=(L^i,R^i)\\
L^i=R^{i-1},R^i=L^{i-1}\oplus f(R^{i-1},K^i)
$$
显然Feistel型轮函数是可逆的，所以f不需要满足单射条件。

DES是16轮Feistel型密码，分组长度为64，密钥空间为$2^56$。

1998年56小时找到了DES密钥

## 高级加密标准

AES要求具有分组长度128，支持128、192、256的密钥长度，轮数依赖于密钥长度

最终**Rijndael**当选

前N-1轮，用S盒进行一次代换SubBytes，对State做一置换ShiftRows，再对State做一次操作MixColumns，然后进行AddRoundKey。最后一轮不用MixColumns。

目前来看，AES是安全的，不存在快于穷尽密钥搜索的攻击。

## 工作模式

四种模式

+ 密码本（ECB）
+ 密码反馈（CFB）：$z_i=e_K(y_{i-1}),\:y_i=x_i\oplus z_i$
+ 密码分组连接（CBC）：$y_i=e_K(y_{i-1}\oplus x_i)$
+ 输出反馈（OFB）：$z_i=e_K(z_{i-1}),\:y_i=x_i\oplus z_i$

ECB和OFB中，改变一个明文分组不影响其他密文分组，常用于信道不安全的通信，OFB常用于卫星通信。

CBC和CFB模式对于认证是有用的，能产生消息认证码MAC。

# Hash函数

Hash函数安全性从三个问题来评估（这三个问题都是难解的才是稳固的）

+ 原像
+ 第二原像
+ 碰撞

随机预言模型：理想的Hash函数，这个模型对x，随机选择Hash函数h，h(x)是完全随机的。

取q个点寻找原像的平均成功率$e=1-(1-1/M)^q$。（也是寻找第二原像的成功率）

取q个点寻找碰撞的成功率为$e=1-P_M^q/M^q$

可以估计$q\approx\sqrt{2Mln(1/(1-e))}$，（这就说明大约$\sqrt{M}$个随机元素计算有50%概率出现碰撞）



104

